diff --git a/dist/tres.js b/dist/tres.js
index e34aab2230960399c4199ab6bf3c9c166d3af067..29e4879b7dfa6ad16c1420cbb4dd08b9a8dd6012 100644
--- a/dist/tres.js
+++ b/dist/tres.js
@@ -663,7 +663,8 @@ function gr({
   };
 }
 function vr(e, t, n = 10) {
-  const r = A(e) ? sn() : an(q(() => A(t).parentElement)), o = we(Ne(r.width, n)), l = we(Ne(r.height, n)), s = q(() => o.value / l.value);
+  const { width } = sn();
+  const r = A(e) ? { width, height: I(window.screen.availHeight) } : an(q(() => A(t).parentElement)), o = we(Ne(r.width, n)), l = we(Ne(r.height, n)), s = q(() => o.value / l.value);
   return {
     height: l,
     width: o,
diff --git a/dist/tres.umd.cjs b/dist/tres.umd.cjs
index fceadcfeaa03eb91f10a83339ecf1f746a3ae4fd..99020ddee7403b3694364c3e0670621c98368362 100644
--- a/dist/tres.umd.cjs
+++ b/dist/tres.umd.cjs
@@ -5,4 +5,4 @@
  * description: Declarative ThreeJS using Vue Components
  * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
  */
-(function(w,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vue"),require("three"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","three","@vueuse/core"],d):(w=typeof globalThis<"u"?globalThis:w||self,d(w.tres={},w.Vue,w.Three,w.VueUseCore))})(this,function(w,d,v,M){"use strict";var Pn=Object.defineProperty;var Sn=(w,d,v)=>d in w?Pn(w,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[d]=v;var ye=(w,d,v)=>Sn(w,typeof d!="symbol"?d+"":d,v);function ct(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const _e=ct(v),ut={name:"@tresjs/core",type:"module",version:"4.3.3",packageManager:"pnpm@9.15.5",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",repository:{type:"git",url:"git+https://github.com/Tresjs/tres.git"},keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",require:"./dist/tres.umd.cjs"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},main:"./dist/tres.js",module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:serve":"vitepress serve docs","docs:preview":"vitepress preview docs","docs:contributors":"esno scripts/update-contributors.ts"},peerDependencies:{three:">=0.133",vue:">=3.4"},dependencies:{"@alvarosabu/utils":"^3.2.0","@vue/devtools-api":"^6.6.3","@vueuse/core":"^12.5.0"},devDependencies:{"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"4.1.0","@tresjs/eslint-config":"^1.4.0","@types/three":"^0.173.0","@typescript-eslint/eslint-plugin":"^8.23.0","@typescript-eslint/parser":"^8.23.0","@vitejs/plugin-vue":"^5.2.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.0.5","@vitest/ui":"^3.0.5","@vue/test-utils":"^2.4.6",eslint:"^9.19.0","eslint-plugin-vue":"^9.32.0",esno:"^4.8.0",gsap:"^3.12.7",jsdom:"^26.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.2","release-it":"^18.1.2","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^5.14.0",sponsorkit:"^16.3.0",three:"^0.173.0",unocss:"^65.4.3",unplugin:"^2.1.2","unplugin-vue-components":"^28.0.0",vite:"^6.1.0","vite-plugin-banner":"^0.8.0","vite-plugin-dts":"4.5.0","vite-plugin-inspect":"^10.1.0","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.3",vitest:"3.0.5",vue:"3.5.13","vue-demi":"^0.14.10"}};function we(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}async function be(e,t,n,r,o){const{logError:l}=G(),s=new e;return o&&o(s),n&&n(s),await new Promise((a,c)=>{s.load(t,i=>{const f=i;f.scene&&Object.assign(f,we(f.scene)),a(f)},r,i=>{l("[useLoader] - Failed to load resource",i),c(i)})})}const ft=d.defineComponent({__name:"component",props:{loader:{},url:{}},async setup(e){let t,n;const r=e,o=([t,n]=d.withAsyncContext(()=>d.reactive(be(r.loader,r.url))),t=await t,n(),t);return(l,s)=>d.renderSlot(l.$slots,"default",{data:d.unref(o)})}});class dt extends _e.Mesh{constructor(...n){super(...n);ye(this,"type","HightlightMesh");ye(this,"createTime");this.createTime=Date.now()}onBeforeRender(){const r=(Date.now()-this.createTime)/1e3,s=1+.07*Math.sin(2.5*r);this.scale.set(s,s,s)}}function ue(e){return typeof e>"u"}function Z(e){return Array.isArray(e)}function pt(e){return typeof e=="number"}function Ce(e){return typeof e=="string"}function N(e){return typeof e=="function"}function $(e){return e===Object(e)&&!Z(e)&&!N(e)}function V(e){return $(e)&&"isObject3D"in e&&!!e.isObject3D}function Me(e){return $(e)&&"isCamera"in e&&!!e.isCamera}function mt(e){return $(e)&&"isBufferGeometry"in e&&!!e.isBufferGeometry}function ht(e){return $(e)&&"isMaterial"in e&&!!e.isMaterial}function gt(e){return $(e)&&"isLight"in e&&!!e.isLight}function vt(e){return $(e)&&"isFog"in e&&!!e.isFog}function yt(e){return $(e)&&"isScene"in e&&!!e.isScene}function ee(e){return V(e)||mt(e)||ht(e)||vt(e)}function _t(e){return $(e)&&!!e.isPrimitive}const Pe=(e,t)=>{for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],Pe(e[n],t[n]));return Object.assign(e||{},t),e},wt=Mt("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function Se(e){return e&&e.nodeType===1}function te(e){return e.replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}const bt=/\B([A-Z])/g;function Ct(e){return e.replace(bt,"-$1").toLowerCase()}function Mt(e,t){const n=Object.create(null),r=e.split(",");for(let o=0;o<r.length;o++)n[r[o]]=!0;return t?o=>!!n[o.toLowerCase()]:o=>!!n[o]}const ke=(e,t)=>{if(!t)return;const n=Array.isArray(t)?t:t.match(/([^[.\]])+/g);return n==null?void 0:n.reduce((r,o)=>r&&r[o],e)},Pt=(e,t,n)=>{const r=Array.isArray(t)?t:t.match(/([^[.\]])+/g);r&&r.reduce((o,l,s)=>(o[l]===void 0&&(o[l]={}),s===r.length-1&&(o[l]=n),o[l]),e)};function Ae(e,t){if(Se(e)&&Se(t)){const o=e.attributes,l=t.attributes;return o.length!==l.length?!1:Array.from(o).every(({name:s,value:a})=>t.getAttribute(s)===a)}if(e===t)return!0;if(e===null||typeof e!="object"||t===null||typeof t!="object")return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(!r.includes(o)||!Ae(e[o],t[o]))return!1;return!0}function St(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ae(e[n],t[n]))return!1;return!0}const kt=Array.isArray;function At(e,t,n,r){const o=c=>{if(c.uuid===t)return c;for(const i of c.children){const f=o(i);if(f)return f}},l=o(e);if(!l){console.warn("Object with UUID not found in the scene.");return}let s=l;for(let c=0;c<n.length-1;c++)if(s[n[c]]!==void 0)s=s[n[c]];else{console.warn(`Property path is not valid: ${n.join(".")}`);return}const a=n[n.length-1];s[a]!==void 0?s[a]=r:console.warn(`Property path is not valid: ${n.join(".")}`)}function Lt(e){const t=new v.MeshBasicMaterial({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:v.DoubleSide});return new dt(e.geometry.clone(),t)}function Ot(e){var n;let t=e.value;return e.value&&((n=e.value)!=null&&n.isMesh)&&(t=e.value.position),Array.isArray(e.value)&&(t=new v.Vector3(...t)),t}function Dt(e){return"map"in e}function Le(e){Dt(e)&&e.map&&e.map.dispose(),e.dispose()}function fe(e){var n,r;if(e.parent&&((n=e.removeFromParent)==null||n.call(e)),delete e.__tres,[...e.children].forEach(o=>fe(o)),!(e instanceof v.Scene)){const o=e;e&&((r=e.dispose)==null||r.call(e)),o.geometry&&o.geometry.dispose(),Array.isArray(o.material)?o.material.forEach(l=>Le(l)):o.material&&Le(o.material)}}function jt(e,t){let n=0;for(let r=0;r<e.length;r++)t(e[r],r)&&(e[n]=e[r],n++);return e.length=n,e}function de(e,t){let n=e;if(t.includes("-")){const r=t.split("-");let o=r.shift();for(;n&&r.length;)o in n?(n=n[o],o=r.shift()):o=Oe(o,r.shift());return{target:n,key:Oe(o,...r)}}else return{target:n,key:t}}function Oe(...e){return e.map((t,n)=>n===0?t:t.charAt(0).toUpperCase()+t.slice(1)).join("")}const De=/-\d+$/;function Tt(e,t,n){if(Ce(n)){if(De.test(n)){const l=n.replace(De,""),{target:s,key:a}=de(e,l);if(!Array.isArray(s[a])){const c=s[a],i=[];i.__tresDetach=()=>{i.every(f=>ue(f))&&(s[a]=c)},s[a]=i}}const{target:r,key:o}=de(e,n);t.__tres.previousAttach=r[o],r[o]=q(t)}else t.__tres.previousAttach=n(e,t)}function xt(e,t,n){var r,o,l;if(Ce(n)){const{target:s,key:a}=de(e,n),c=t.__tres.previousAttach;c===void 0?delete s[a]:s[a]=c,"__tresDetach"in s&&s.__tresDetach()}else(o=(r=t.__tres)==null?void 0:r.previousAttach)==null||o.call(r,e,t);(l=t.__tres)==null||delete l.previousAttach}function z(e,t,n){const r=e;return r.__tres={type:"unknown",eventCount:0,root:n,handlers:{},memoizedProps:{},objects:[],parent:null,previousAttach:null,...t},r.__tres.attach||(r.isMaterial?r.__tres.attach="material":r.isBufferGeometry?r.__tres.attach="geometry":r.isFog&&(r.__tres.attach="fog")),r}function je(e){var n;const t=(n=e==null?void 0:e.__tres)==null?void 0:n.root;t&&t.render&&t.render.canBeInvalidated.value&&t.invalidate()}function Yn(e){}function Bt(e,t,n){var o;if(!N(e.setPixelRatio))return;let r=0;if(n&&Z(n)){const l=n;if(l.length>=2){const[s,a]=l;r=v.MathUtils.clamp(t,s,a)}}else pt(n)?r=n:r=t;r!==((o=e.getPixelRatio)==null?void 0:o.call(e))&&e.setPixelRatio(r)}function It(e,t,n,r,o){const l=[...t.__tres.objects],s=q(t);if(e=q(e),s===e)return!0;const a=z(e,t.__tres??{},o),c=t.parent??t.__tres.parent??null,i={...t.__tres.memoizedProps};delete i.object;for(const f of l)Te(f,o),xe(f,o);s.__tres.objects=[],r.remove(t);for(const[f,y]of Object.entries(i))r.patchProp(a,f,a[f],y);n(e),r.insert(t,c);for(const f of l)r.insert(f,t);return!0}function q(e){return _t(e)?(e.object.__tres=e.__tres,e.object):e}function Te(e,t){var r,o,l,s;const n=((r=e.__tres)==null?void 0:r.parent)||t.scene.value;e.__tres&&(e.__tres.parent=null),n&&n.__tres&&"objects"in n.__tres&&jt(n.__tres.objects,a=>a!==e),(o=e.__tres)!=null&&o.attach?xt(n,e,e.__tres.attach):((s=(l=e.parent)==null?void 0:l.remove)==null||s.call(l,q(e)),e.parent=null)}function xe(e,t){var n;(n=e.traverse)==null||n.call(e,r=>{var o;t.deregisterCamera(r),(o=t.eventManager)==null||o.deregisterPointerMissedObject(r)}),t.deregisterCamera(e),je(e)}async function Be(e,t){const n=new v.TextureLoader(t),r=o=>new Promise((l,s)=>{n.load(o,a=>l(a),()=>null,()=>{s(new Error("[useTextures] - Failed to load texture"))})});if(kt(e)){const o=await Promise.all(e.map(l=>r(l)));return e.length>1?o:o[0]}else{const{map:o,displacementMap:l,normalMap:s,roughnessMap:a,metalnessMap:c,aoMap:i,alphaMap:f,matcap:y}=e;return{map:o?await r(o):null,displacementMap:l?await r(l):null,normalMap:s?await r(s):null,roughnessMap:a?await r(a):null,metalnessMap:c?await r(c):null,aoMap:i?await r(i):null,alphaMap:f?await r(f):null,matcap:y?await r(y):null}}}const Et=d.defineComponent({__name:"component",props:{map:{},displacementMap:{},normalMap:{},roughnessMap:{},metalnessMap:{},aoMap:{},alphaMap:{},matcap:{}},async setup(e){let t,n;const r=e,o=([t,n]=d.withAsyncContext(()=>d.reactive(Be(r))),t=await t,n(),t);return(l,s)=>d.renderSlot(l.$slots,"default",{textures:d.unref(o)})}}),Ie=({sizes:e})=>{const t=d.ref([]),n=d.computed(()=>t.value[0]),r=s=>{const a=s instanceof v.Camera?s:t.value.find(i=>i.uuid===s);if(!a)return;const c=t.value.filter(({uuid:i})=>i!==a.uuid);t.value=[a,...c]},o=(s,a=!1)=>{if(Me(s)){const c=s;if(t.value.some(({uuid:i})=>i===c.uuid))return;a?r(c):t.value.push(c)}},l=s=>{if(Me(s)){const a=s;t.value=t.value.filter(({uuid:c})=>c!==a.uuid)}};return d.watchEffect(()=>{e.aspectRatio.value&&t.value.forEach(s=>{!s.manual&&(s instanceof v.PerspectiveCamera||$t(s))&&(s instanceof v.PerspectiveCamera?s.aspect=e.aspectRatio.value:(s.left=e.width.value*-.5,s.right=e.width.value*.5,s.top=e.height.value*.5,s.bottom=e.height.value*-.5),s.updateProjectionMatrix())})}),d.onUnmounted(()=>{t.value=[]}),{camera:n,cameras:t,registerCamera:o,deregisterCamera:l,setCameraActive:r}};function $t(e){return e.hasOwnProperty("isOrthographicCamera")&&e.isOrthographicCamera}const Rt=!0,ne="[TresJS ▲ ■ ●] ";function Ut(...e){typeof e[0]=="string"?e[0]=ne+e[0]:e.unshift(ne),console.error(...e)}function Vt(...e){typeof e[0]=="string"?e[0]=ne+e[0]:e.unshift(ne),console.warn(...e)}function Ft(e,t){}function G(){return{logError:Ut,logWarning:Vt,logMessage:Ft}}const re=d.ref({}),oe=e=>Object.assign(re.value,e);function pe(){const e=new Map,t=new Set;let n=0,r=!1;const o=()=>{const i=Array.from(e.entries()).sort((f,y)=>{const u=f[1].priority-y[1].priority;return u===0?f[1].addI-y[1].addI:u});t.clear(),i.forEach(f=>t.add(f[0]))},l=i=>{e.delete(i),t.delete(i)};return{on:(i,f=0)=>{e.set(i,{priority:f,addI:n++});const y=()=>l(i);return M.tryOnScopeDispose(y),r=!0,{off:y}},off:l,trigger:(...i)=>{r&&(o(),r=!1),t.forEach(f=>f(...i))},dispose:()=>{e.clear(),t.clear()},get count(){return e.size}}}function Ee(){let e=!0,t=!0,n=!1;const r=new v.Clock(!1),o=d.ref(r.running),l=d.ref(!1);let s;const a=v.MathUtils.generateUUID();let c=null;const i=pe(),f=pe(),y=pe();j();let u={};function b(k){u=k}function m(k,T,h=0){switch(T){case"before":return i.on(k,h);case"render":return c||(c=k),f.dispose(),f.on(k);case"after":return y.on(k,h)}}function C(){t&&(t=!1,j(),O())}function p(){t=!0,j(),cancelAnimationFrame(s)}function _(){n=!1,j()}function A(){n=!0,j()}function L(){l.value=!0}function P(){l.value=!1}function O(){if(!e){s=requestAnimationFrame(O);return}const k=r.getDelta(),T=r.getElapsedTime(),h={camera:d.unref(u.camera),scene:d.unref(u.scene),renderer:d.unref(u.renderer),raycaster:d.unref(u.raycaster),controls:d.unref(u.controls),invalidate:u.invalidate,advance:u.advance},S={delta:k,elapsed:T,clock:r,...h};o.value&&i.trigger(S),l.value||(f.count?f.trigger(S):c&&c(S)),o.value&&y.trigger(S),s=requestAnimationFrame(O)}function j(){const k=!t&&!n;r.running!==k&&(r.running?r.stop():r.start()),o.value=r.running}return{loopId:a,register:(k,T,h)=>m(k,T,h),start:C,stop:p,pause:A,resume:_,pauseRender:L,resumeRender:P,isRenderPaused:l,isActive:o,setContext:b,setReady:k=>e=k}}function me(e){let t=0;return e.traverse(n=>{if(n.isMesh&&n.geometry&&n.type!=="HightlightMesh"){const r=n.geometry,o=r.attributes.position.count*3*Float32Array.BYTES_PER_ELEMENT,l=r.index?r.index.count*Uint32Array.BYTES_PER_ELEMENT:0,s=r.attributes.normal?r.attributes.normal.count*3*Float32Array.BYTES_PER_ELEMENT:0,a=r.attributes.uv?r.attributes.uv.count*2*Float32Array.BYTES_PER_ELEMENT:0,c=o+l+s+a;t+=c}}),t}function Wt(e){return(e/1024).toFixed(2)}const Nt=Number.parseInt(v.REVISION.replace("dev",""));function zt(e){return typeof e=="number"?[e,e,e]:e instanceof v.Vector3?[e.x,e.y,e.z]:e}function $e(e){return e instanceof v.Color?e:Array.isArray(e)?new v.Color(...e):new v.Color(e)}const se={realistic:{shadows:!0,physicallyCorrectLights:!0,outputColorSpace:v.SRGBColorSpace,toneMapping:v.ACESFilmicToneMapping,toneMappingExposure:3,shadowMap:{enabled:!0,type:v.PCFSoftShadowMap}},flat:{toneMapping:v.NoToneMapping,toneMappingExposure:1}};function Re({canvas:e,options:t,contextParts:{sizes:n,render:r,invalidate:o,advance:l}}){const s=d.computed(()=>({alpha:M.toValue(t.alpha)??!0,depth:M.toValue(t.depth),canvas:M.unrefElement(e),context:M.toValue(t.context),stencil:M.toValue(t.stencil),antialias:M.toValue(t.antialias)??!0,precision:M.toValue(t.precision),powerPreference:M.toValue(t.powerPreference),premultipliedAlpha:M.toValue(t.premultipliedAlpha),preserveDrawingBuffer:M.toValue(t.preserveDrawingBuffer),logarithmicDepthBuffer:M.toValue(t.logarithmicDepthBuffer),failIfMajorPerformanceCaveat:M.toValue(t.failIfMajorPerformanceCaveat)})),a=d.shallowRef(new v.WebGLRenderer(s.value));function c(){t.renderMode==="on-demand"&&o()}d.watch(s,()=>{a.value.dispose(),a.value=new v.WebGLRenderer(s.value),c()}),d.watch([n.width,n.height],()=>{a.value.setSize(n.width.value,n.height.value),c()},{immediate:!0}),d.watch(()=>t.clearColor,c);const{pixelRatio:i}=M.useDevicePixelRatio(),{logError:f}=G(),u=(()=>{const m=new v.WebGLRenderer,C={shadowMap:{enabled:m.shadowMap.enabled,type:m.shadowMap.type},toneMapping:m.toneMapping,toneMappingExposure:m.toneMappingExposure,outputColorSpace:m.outputColorSpace};return m.dispose(),C})(),b=M.toValue(t.renderMode);return b==="on-demand"&&o(),b==="manual"&&setTimeout(()=>{l()},100),d.watchEffect(()=>{const m=M.toValue(t.preset);m&&(m in se||f(`Renderer Preset must be one of these: ${Object.keys(se).join(", ")}`),Pe(a.value,se[m])),Bt(a.value,i.value,M.toValue(t.dpr)),b==="always"&&(r.frames.value=Math.max(1,r.frames.value));const C=(A,L)=>{const P=M.toValue(A),O=()=>{if(m)return ke(se[m],L)};if(P!==void 0)return P;const j=O();return j!==void 0?j:ke(u,L)},p=(A,L)=>Pt(a.value,L,C(A,L));p(t.shadows,"shadowMap.enabled"),p(t.toneMapping??v.ACESFilmicToneMapping,"toneMapping"),p(t.shadowMapType,"shadowMap.type"),Nt<150&&p(!t.useLegacyLights,"physicallyCorrectLights"),p(t.outputColorSpace,"outputColorSpace"),p(t.toneMappingExposure,"toneMappingExposure");const _=C(t.clearColor,"clearColor");_&&a.value.setClearColor(_?$e(_):new v.Color(0))}),d.onUnmounted(()=>{a.value.dispose(),a.value.forceContextLoss()}),{renderer:a}}function Gt(e,t,n=10){const r=M.toValue(e)?M.useWindowSize():M.useElementSize(d.computed(()=>M.toValue(t).parentElement)),o=d.readonly(M.refDebounced(r.width,n)),l=d.readonly(M.refDebounced(r.height,n)),s=d.computed(()=>o.value/l.value);return{height:l,width:o,aspectRatio:s}}const Ue=(e,t)=>{const n=d.computed(()=>t.renderer.value.domElement),r=d.shallowRef([]),{x:o,y:l}=M.usePointer({target:n});let s=0;const{width:a,height:c,top:i,left:f}=M.useElementBounding(n),y=({x:g,y:D})=>{if(n.value)return{x:(g-f.value)/a.value*2-1,y:-((D-i.value)/c.value)*2+1}},u=({x:g,y:D})=>{if(t.camera.value)return t.raycaster.value.setFromCamera(new v.Vector2(g,D),t.camera.value),r.value=t.raycaster.value.intersectObjects(e.value,!0),r.value},b=g=>{const D=y({x:(g==null?void 0:g.clientX)??o.value,y:(g==null?void 0:g.clientY)??l.value});return D?u(D)||[]:[]},m=M.createEventHook(),C=M.createEventHook(),p=M.createEventHook(),_=M.createEventHook(),A=M.createEventHook(),L=M.createEventHook(),P=M.createEventHook(),O=M.createEventHook();function j(g){const D={};for(const W in g)typeof W!="function"&&(D[W]=g[W]);return D}const k=(g,D)=>{var it,at,lt;const W=j(D),ce=new v.Vector3(D==null?void 0:D.clientX,D==null?void 0:D.clientY,0).unproject((it=t.camera)==null?void 0:it.value);g.trigger({...W,intersections:r.value,unprojectedPoint:ce,ray:(at=t.raycaster)==null?void 0:at.value.ray,camera:(lt=t.camera)==null?void 0:lt.value,sourceEvent:D,delta:s,stopPropagating:!1})};let T;const h=g=>{b(g),k(p,g),T=g},S=()=>{T&&h(T)};let x,B,I;const U=g=>{var D;x=(D=r.value[0])==null?void 0:D.object,s=0,B=new v.Vector2((g==null?void 0:g.clientX)??o.value,(g==null?void 0:g.clientY)??l.value),k(A,g)};let E,K=!1;const nt=g=>{var D,W,ce;g instanceof PointerEvent&&(r.value.length===0&&k(L,g),x===((D=r.value[0])==null?void 0:D.object)&&(I=new v.Vector2((g==null?void 0:g.clientX)??o.value,(g==null?void 0:g.clientY)??l.value),s=B==null?void 0:B.distanceTo(I),g.button===0?(k(m,g),E===((W=r.value[0])==null?void 0:W.object)?K=!0:(E=(ce=r.value[0])==null?void 0:ce.object,K=!1)):g.button===2&&k(P,g)),k(_,g))},rt=g=>{K&&(k(C,g),E=void 0,K=!1)},ot=g=>k(p,g),st=g=>k(O,g);return n.value.addEventListener("pointerup",nt),n.value.addEventListener("pointerdown",U),n.value.addEventListener("pointermove",h),n.value.addEventListener("pointerleave",ot),n.value.addEventListener("dblclick",rt),n.value.addEventListener("wheel",st),d.onUnmounted(()=>{n!=null&&n.value&&(n.value.removeEventListener("pointerup",nt),n.value.removeEventListener("pointerdown",U),n.value.removeEventListener("pointermove",h),n.value.removeEventListener("pointerleave",ot),n.value.removeEventListener("dblclick",rt),n.value.removeEventListener("wheel",st))}),{intersects:r,onClick:g=>m.on(g).off,onDblClick:g=>C.on(g).off,onContextMenu:g=>P.on(g).off,onPointerMove:g=>p.on(g).off,onPointerUp:g=>_.on(g).off,onPointerDown:g=>A.on(g).off,onPointerMissed:g=>L.on(g).off,onWheel:g=>O.on(g).off,forceUpdate:S}};function he(e,t){if(Array.isArray(e))for(const n of e)n(t);typeof e=="function"&&e(t)}function Ve(e,t,n){var T;const r=d.shallowRef(),o=d.shallowRef();e&&(r.value=e),t&&(o.value=t);const l=h=>{var S;return((S=h.__tres)==null?void 0:S.eventCount)>0},s=h=>{var S;return((S=h.children)==null?void 0:S.some(x=>s(x)))||l(h)},a=d.shallowRef(((T=r.value)==null?void 0:T.children).filter(s)||[]);function c(h,S){const x=[],B=()=>S.stopPropagating=!0;S.stopPropagation=B;for(const I of S==null?void 0:S.intersections){if(S.stopPropagating)return;S={...S,...I};const{object:U}=I;S.eventObject=U,he(U[h],S),x.push(U);let E=U.parent;for(;E!==null&&!S.stopPropagating&&!x.includes(E);)S.eventObject=E,he(E[h],S),x.push(E),E=E.parent;const K=Ct(h.slice(2));n(K,{intersection:I,event:S})}}const{onClick:i,onDblClick:f,onContextMenu:y,onPointerMove:u,onPointerDown:b,onPointerUp:m,onPointerMissed:C,onWheel:p,forceUpdate:_}=Ue(a,t);m(h=>c("onPointerUp",h)),b(h=>c("onPointerDown",h)),i(h=>c("onClick",h)),f(h=>c("onDoubleClick",h)),y(h=>c("onContextMenu",h)),p(h=>c("onWheel",h));let A=[];u(h=>{const S=h.intersections.map(({object:B})=>B),x=h.intersections;A.forEach(({object:B})=>{S.includes(B)||(h.intersections=A,c("onPointerLeave",h),c("onPointerOut",h))}),h.intersections=x,h.intersections.forEach(({object:B})=>{A.includes(B)||(c("onPointerEnter",h),c("onPointerOver",h))}),c("onPointerMove",h),A=h.intersections});const L=[];C(h=>{const S=()=>h.stopPropagating=!0;h.stopPropagation=S,L.forEach(x=>{h.stopPropagating||(h.eventObject=x,he(x.onPointerMissed,h))}),n("pointer-missed",{event:h})});function P(h){ee(h)&&V(h)&&a.value.push(h)}function O(h){if(ee(h)&&V(h)){const S=a.value.indexOf(h);S>-1&&a.value.splice(S,1)}}function j(h){ee(h)&&V(h)&&h.onPointerMissed&&L.push(h)}function k(h){if(ee(h)&&V(h)){const S=L.indexOf(h);S>-1&&L.splice(S,1)}}return t.eventManager={forceUpdate:_,registerObject:P,deregisterObject:O,registerPointerMissedObject:j,deregisterPointerMissedObject:k},{forceUpdate:_,registerObject:P,deregisterObject:O,registerPointerMissedObject:j,deregisterPointerMissedObject:k}}function qt(e,t,n=100){n=n<=0?100:n;const r=M.createEventHook(),o=new Set;let l=!1,s=!1,a=null;function c(){a&&clearTimeout(a),!s&&!l&&e()?(r.trigger(t),o.forEach(u=>u()),o.clear(),l=!0):!s&&!l&&(a=setTimeout(c,n))}function i(){s=!0,a&&clearTimeout(a)}c();const f=(u,...b)=>{u(...b)};return{on:u=>{if(l)return f(u,t),{off:()=>{}};{const b=r.on(u);return o.add(b.off),r.on(u)}},off:r.off,trigger:r.trigger,clear:r.clear,cancel:i}}const J=new WeakMap;function Fe(e){if(e=e||Q(),J.has(e))return J.get(e);const t=100,n=Date.now(),l=qt(()=>{if(Date.now()-n>=t)return!0;{const s=e.renderer.value,a=(s==null?void 0:s.domElement)||{width:0,height:0};return!!(s&&a.width>0&&a.height>0)}},e);return J.set(e,l),l}function Yt(e){const t=Q();if(t)return J.has(t)?J.get(t).on(e):Fe(t).on(e)}function We({scene:e,canvas:t,windowSize:n,rendererOptions:r,emit:o}){const l=d.shallowRef(e),s=Gt(n,t),{camera:a,cameras:c,registerCamera:i,deregisterCamera:f,setCameraActive:y}=Ie({sizes:s}),u={mode:d.ref(r.renderMode||"always"),priority:d.ref(0),frames:d.ref(0),maxFrames:60,canBeInvalidated:d.computed(()=>u.mode.value==="on-demand"&&u.frames.value===0)};function b(I=1){r.renderMode==="on-demand"&&(u.frames.value=Math.min(u.maxFrames,u.frames.value+I))}function m(){r.renderMode==="manual"&&(u.frames.value=1)}const{renderer:C}=Re({canvas:t,options:r,contextParts:{sizes:s,render:u,invalidate:b,advance:m}}),p={sizes:s,scene:l,camera:a,cameras:d.readonly(c),renderer:C,raycaster:d.shallowRef(new v.Raycaster),controls:d.ref(null),perf:{maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},render:u,advance:m,extend:oe,invalidate:b,registerCamera:i,setCameraActive:y,deregisterCamera:f,loop:Ee()};d.provide("useTres",p),p.scene.value.__tres={root:p},p.loop.register(()=>{a.value&&u.frames.value>0&&(C.value.render(e,a.value),o("render",p.renderer.value)),u.priority.value=0,u.mode.value==="always"?u.frames.value=1:u.frames.value=Math.max(0,u.frames.value-1)},"render");const{on:_,cancel:A}=Fe(p);p.loop.setReady(!1),p.loop.start(),_(()=>{o("ready",p),p.loop.setReady(!0),Ve(e,p,o)}),d.onUnmounted(()=>{A(),p.loop.stop()});const L=100,P=M.useFps({every:L}),{isSupported:O,memory:j}=M.useMemory({interval:L}),k=160;let T=performance.now();const h=({timestamp:I})=>{p.scene.value&&(p.perf.memory.allocatedMem=me(p.scene.value)),I-T>=L&&(T=I,p.perf.fps.accumulator.push(P.value),p.perf.fps.accumulator.length>k&&p.perf.fps.accumulator.shift(),p.perf.fps.value=P.value,O.value&&j.value&&(p.perf.memory.accumulator.push(j.value.usedJSHeapSize/1024/1024),p.perf.memory.accumulator.length>k&&p.perf.memory.accumulator.shift(),p.perf.memory.currentMem=p.perf.memory.accumulator.reduce((U,E)=>U+E,0)/p.perf.memory.accumulator.length))};let S=0;const x=1,{pause:B}=M.useRafFn(({delta:I})=>{window.__TRES__DEVTOOLS__&&(h({timestamp:performance.now()}),S+=I,S>=x&&(window.__TRES__DEVTOOLS__.cb(p),S=0))},{immediate:!0});return d.onUnmounted(()=>{B()}),p}function Q(){const e=d.inject("useTres");if(!e)throw new Error("useTresContext must be used together with useTresContextProvider");return e}const Kt=Q;function Jt(){const{camera:e,scene:t,renderer:n,loop:r,raycaster:o,controls:l,invalidate:s,advance:a}=Q();r.setContext({camera:e,scene:t,renderer:n,raycaster:o,controls:l,invalidate:s,advance:a});function c(y,u=0){return r.register(y,"before",u)}function i(y){return r.register(y,"render")}function f(y,u=0){return r.register(y,"after",u)}return{pause:r.pause,resume:r.resume,pauseRender:r.pauseRender,resumeRender:r.resumeRender,isActive:r.isActive,onBeforeRender:c,render:i,onAfterRender:f}}const Ne=M.createEventHook(),ze=M.createEventHook(),ge=M.createEventHook(),X=new v.Clock;let ie=0,ae=0;const{pause:Qt,resume:Ge,isActive:Xt}=M.useRafFn(()=>{Ne.trigger({delta:ie,elapsed:ae,clock:X}),ze.trigger({delta:ie,elapsed:ae,clock:X}),ge.trigger({delta:ie,elapsed:ae,clock:X})},{immediate:!1});ge.on(()=>{ie=X.getDelta(),ae=X.getElapsedTime()});let qe=!1;const Ht=()=>(qe||(qe=!0,Ge()),{onBeforeLoop:Ne.on,onLoop:ze.on,onAfterLoop:ge.on,pause:Qt,resume:Ge,isActive:Xt});function Zt(){const{logWarning:e}=G();function t(l,s,a){let c=null;return l.traverse(i=>{i[s]===a&&(c=i)}),c||e(`Child with ${s} '${a}' not found.`),c}function n(l,s,a){const c=[];return l.traverse(i=>{i[s].includes(a)&&c.push(i)}),c.length||e(`Children with ${s} '${a}' not found.`),c}function r(l,s){return t(l,"name",s)}function o(l,s){return n(l,"name",s)}return{seek:t,seekByName:r,seekAll:n,seekAllByName:o}}function en(e,t={},n={}){let r=e;const o=a=>{r=a};let l=new Proxy({},{});const s={has(a,c){return c in t||c in r},get(a,c,i){return c in t?t[c](r):r[c]},set(a,c,i){const f=n[c];return f&&typeof f=="function"?f(i,r,l,o):r[c]=i,!0}};return l=new Proxy({},s),l}const{logError:Ye}=G(),Ke=["onClick","onContextMenu","onPointerMove","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onDoubleClick","onPointerDown","onPointerUp","onPointerCancel","onPointerMissed","onLostPointerCapture","onWheel"],tn=e=>{const t=e.scene.value;function n(i,f,y,u){if(u||(u={}),u.args||(u.args=[]),i==="template"||wt(i))return null;let b=i.replace("Tres",""),m;if(i==="primitive"){(!$(u.object)||d.isRef(u.object))&&Ye("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),b=u.object.type;const C={};m=en(u.object,{object:_=>_,isPrimitive:()=>!0,__tres:()=>C},{object:(_,A,L,P)=>{It(_,L,P,{patchProp:l,remove:o,insert:r},e)},__tres:_=>{Object.assign(C,_)}})}else{const C=re.value[b];C||Ye(`${b} is not defined on the THREE namespace. Use extend to add it to the catalog.`),m=new C(...u.args)}return m?(m.isCamera&&(u!=null&&u.position||m.position.set(3,3,3),u!=null&&u.lookAt||m.lookAt(0,0,0)),m=z(m,{...m.__tres,type:b,memoizedProps:u,eventCount:0,primitive:i==="primitive",attach:u.attach},e),m):null}function r(i,f){var b,m,C;if(!i)return;f=f||t;const y=i.__tres?i:z(i,{},e),u=f.__tres?f:z(f,{},e);i=q(y),f=q(u),i.__tres&&((b=i.__tres)==null?void 0:b.eventCount)>0&&((m=e.eventManager)==null||m.registerObject(i)),e.registerCamera(i),(C=e.eventManager)==null||C.registerPointerMissedObject(i),y.__tres.attach?Tt(u,y,y.__tres.attach):V(i)&&V(u)&&(u.add(i),i.dispatchEvent({type:"added"})),y.__tres.parent=u,u.__tres.objects&&!u.__tres.objects.includes(y)&&u.__tres.objects.push(y)}function o(i,f){var m,C,p,_;if(!i)return;i!=null&&i.__tres&&((m=i.__tres)==null?void 0:m.eventCount)>0&&((C=e.eventManager)==null||C.deregisterObject(i)),f=ue(f)?"default":f;const y=(p=i.__tres)==null?void 0:p.dispose;ue(y)||(y===null?f=!1:f=y);const u=(_=i.__tres)==null?void 0:_.primitive,b=f==="default"?!u:!!f;if(i.__tres&&"objects"in i.__tres&&[...i.__tres.objects].forEach(A=>o(A,f)),b&&i.children&&[...i.children].forEach(A=>o(A,f)),Te(i,e),xe(i,e),b&&!yt(i)){if(N(f))f(i);else if(N(i.dispose))try{i.dispose()}catch{}}"__tres"in i&&delete i.__tres}function l(i,f,y,u){var A,L;if(!i)return;let b=i,m=f;if(i.__tres&&(i.__tres.memoizedProps[f]=u),f==="attach"){const P=((A=i.__tres)==null?void 0:A.parent)||i.parent;o(i),z(i,{attach:u},e),P&&r(i,P);return}if(f==="dispose"){i.__tres||(i=z(i,{},e)),i.__tres.dispose=u;return}if(V(i)&&m==="blocks-pointer-events"){u||u===""?i[m]=u:delete i[m];return}Ke.includes(f)&&i.__tres&&(i.__tres.eventCount+=1);let C=te(m),p=b==null?void 0:b[C];if(m==="args"){const P=i,O=y??[],j=u??[],k=((L=i.__tres)==null?void 0:L.type)||i.type;k&&O.length&&!St(O,j)&&(b=Object.assign(P,new re.value[k](...u)));return}if(b.type==="BufferGeometry"){if(m==="args")return;b.setAttribute(te(m),new v.BufferAttribute(...u));return}if(m.includes("-")&&p===void 0){const P=m.split("-");p=P.reduce((O,j)=>O[te(j)],b),m=P.pop(),C=m,p!=null&&p.set||(b=P.reduce((O,j)=>O[te(j)],b))}let _=u;if(_===""&&(_=!0),N(p)){Ke.includes(f)||(Z(_)?i[C](..._):i[C](_)),C.startsWith("on")&&N(_)&&(b[C]=_);return}!(p!=null&&p.set)&&!N(p)?b[C]=_:p.constructor===_.constructor&&(p!=null&&p.copy)?p==null||p.copy(_):Z(_)?p.set(..._):!p.isColor&&p.setScalar?p.setScalar(_):p.set(_),je(i)}function s(i){var f;return((f=i==null?void 0:i.__tres)==null?void 0:f.parent)||null}function a(i){const f=z(new v.Object3D,{type:"Comment"},e);return f.name=i,f}function c(i){var b;const f=s(i),y=((b=f==null?void 0:f.__tres)==null?void 0:b.objects)||[],u=y.indexOf(i);return u<0||u>=y.length-1?null:y[u+1]}return{insert:r,remove:o,createElement:n,patchProp:l,parentNode:s,createText:()=>void 0,createComment:a,setText:()=>void 0,setElementText:()=>void 0,nextSibling:c,querySelector:()=>void 0,setScopeId:()=>void 0,cloneNode:()=>void 0,insertStaticContent:()=>void 0}};function nn(){return Je().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Je(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const rn=typeof Proxy=="function",on="devtools-plugin:setup",sn="plugin:settings:set";let Y,ve;function an(){var e;return Y!==void 0||(typeof window<"u"&&window.performance?(Y=!0,ve=window.performance):typeof globalThis<"u"&&(!((e=globalThis.perf_hooks)===null||e===void 0)&&e.performance)?(Y=!0,ve=globalThis.perf_hooks.performance):Y=!1),Y}function ln(){return an()?ve.now():Date.now()}class cn{constructor(t,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=n;const r={};if(t.settings)for(const s in t.settings){const a=t.settings[s];r[s]=a.defaultValue}const o=`__vue-devtools-plugin-settings__${t.id}`;let l=Object.assign({},r);try{const s=localStorage.getItem(o),a=JSON.parse(s);Object.assign(l,a)}catch{}this.fallbacks={getSettings(){return l},setSettings(s){try{localStorage.setItem(o,JSON.stringify(s))}catch{}l=s},now(){return ln()}},n&&n.on(sn,(s,a)=>{s===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(s,a)=>this.target?this.target.on[a]:(...c)=>{this.onQueue.push({method:a,args:c})}}),this.proxiedTarget=new Proxy({},{get:(s,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...c)=>(this.targetQueue.push({method:a,args:c,resolve:()=>{}}),this.fallbacks[a](...c)):(...c)=>new Promise(i=>{this.targetQueue.push({method:a,args:c,resolve:i})})})}async setRealTarget(t){this.target=t;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(await this.target[n.method](...n.args))}}function un(e,t){const n=e,r=Je(),o=nn(),l=rn&&n.enableEarlyProxy;if(o&&(r.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!l))o.emit(on,e,t);else{const s=l?new cn(n,o):null;(r.__VUE_DEVTOOLS_PLUGINS__=r.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:s}),s&&t(s.proxiedTarget)}}function fn(e,t){const n=`▲ ■ ●${e}`;typeof Qe=="function"?Qe(n,t):console.log(n)}function Qe(e,t){throw new Error(e+t)}const Xe=e=>{const t={id:e.uuid,label:e.type,children:[],tags:[]};e.name!==""&&t.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const n=me(e);return n>0&&t.tags.push({label:`${Wt(n)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(gt(e)&&t.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),t.tags.push({label:`#${new v.Color(e.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(t.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),t.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),t};function He(e,t,n=""){e.children.forEach(r=>{if(r.type==="HightlightMesh"||n&&!r.type.includes(n)&&!r.name.includes(n))return;const o=Xe(r);t.children.push(o),He(r,o,n)})}const dn=[],H="tres:inspector",pn=d.reactive({sceneGraph:null});function mn(e,t){un({id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://tresjs.org",componentStateTypes:dn,app:e},n=>{typeof n.now!="function"&&fn("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),n.addInspector({id:H,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval(()=>{n.sendInspectorTree(H)},1e3),setInterval(()=>{n.notifyComponentUpdate()},5e3),n.on.getInspectorTree(l=>{if(l.inspectorId===H){const s=Xe(t.scene.value);He(t.scene.value,s,l.filter),pn.sceneGraph=s,l.rootNodes=[s]}});let r=null,o=null;n.on.getInspectorState(l=>{var s;if(l.inspectorId===H){const[a]=t.scene.value.getObjectsByProperty("uuid",l.nodeId);if(!a)return;if(o&&r&&r.parent&&o.remove(r),a.isMesh){const c=Lt(a);a.add(c),r=c,o=a}l.state={object:Object.entries(a).map(([c,i])=>c==="children"?{key:c,value:i.filter(f=>f.type!=="HightlightMesh")}:{key:c,value:i,editable:!0}).filter(({key:c})=>c!=="parent")},a.isScene&&(l.state={...l.state,state:[{key:"Scene Info",value:{objects:a.children.length,memory:me(a),calls:t.renderer.value.info.render.calls,triangles:t.renderer.value.info.render.triangles,points:t.renderer.value.info.render.points,lines:t.renderer.value.info.render.lines}},{key:"Programs",value:((s=t.renderer.value.info.programs)==null?void 0:s.map(c=>({...c,programName:c.name})))||[]}]})}}),n.on.editInspectorState(l=>{l.inspectorId===H&&At(t.scene.value,l.nodeId,l.path,l.state.value)})})}const hn=["data-scene","data-tres"],Ze=d.defineComponent({__name:"TresCanvas",props:{shadows:{type:Boolean,default:void 0},clearColor:{},toneMapping:{},shadowMapType:{},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},camera:{},preset:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},context:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},antialias:{type:Boolean,default:void 0},stencil:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},depth:{type:Boolean,default:void 0},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},reverseDepthBuffer:{type:Boolean}},emits:["render","click","double-click","context-menu","pointer-move","pointer-up","pointer-down","pointer-enter","pointer-leave","pointer-over","pointer-out","pointer-missed","wheel","ready"],setup(e,{expose:t,emit:n}){const r=e,o=n,l=d.useSlots(),s=d.ref(),a=d.shallowRef(new v.Scene),c=d.getCurrentInstance();oe(_e);const i=(m,C=!1)=>d.defineComponent({setup(){var L;const p=(L=d.getCurrentInstance())==null?void 0:L.appContext;p&&(p.app=c==null?void 0:c.appContext.app);const _={};function A(P){P&&(P.parent&&A(P.parent),P.provides&&Object.assign(_,P.provides))}return c!=null&&c.parent&&r.enableProvideBridge&&(A(c.parent),Reflect.ownKeys(_).forEach(P=>{d.provide(P,_[P])})),d.provide("useTres",m),d.provide("extend",oe),typeof window<"u"&&mn(p==null?void 0:p.app,m),()=>d.h(d.Fragment,null,C?[]:l.default())}}),f=(m,C=!1)=>{const p=i(m,C),{render:_}=d.createRenderer(tn(m));_(d.h(p),a.value)},y=(m,C=!1)=>{fe(m.scene.value),C&&(m.renderer.value.dispose(),m.renderer.value.renderLists.dispose(),m.renderer.value.forceContextLoss()),a.value.__tres={root:m}},u=d.shallowRef(null);t({context:u,dispose:()=>y(u.value,!0)});const b=()=>{y(u.value),f(u.value,!0)};return d.onMounted(()=>{const m=s;u.value=We({scene:a.value,canvas:m,windowSize:r.windowSize??!1,rendererOptions:r,emit:o});const{registerCamera:C,camera:p,cameras:_,deregisterCamera:A}=u.value;f(u.value);const L=()=>{const P=new v.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);P.position.set(3,3,3),P.lookAt(0,0,0),C(P);const O=d.watchEffect(()=>{_.value.length>=2&&(P.removeFromParent(),A(P),O==null||O())})};d.watch(()=>r.camera,(P,O)=>{P&&C(P),O&&(O.removeFromParent(),A(O))},{immediate:!0}),p.value||L()}),d.onUnmounted(b),(m,C)=>(d.openBlock(),d.createElementBlock("canvas",{ref_key:"canvas",ref:s,"data-scene":a.value.uuid,class:d.normalizeClass(m.$attrs.class),"data-tres":`tresjs ${d.unref(ut).version}`,style:d.normalizeStyle({display:"block",width:"100%",height:"100%",position:m.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...m.$attrs.style})},null,14,hn))}}),gn=["TresCanvas","TresLeches","TresScene"],vn={template:{compilerOptions:{isCustomElement:e=>e.startsWith("Tres")&&!gn.includes(e)||e==="primitive"}}},{logWarning:yn}=G();let R=null;const _n={updated:(e,t)=>{var o;const n=Ot(t);if(!n){yn(`v-distance-to: problem with binding value: ${t.value}`);return}R&&(R.dispose(),e.parent.remove(R));const r=n.clone().sub(e.position);r.normalize(),R=new v.ArrowHelper(r,e.position,e.position.distanceTo(n),16776960),e.parent.add(R),console.table([["Distance:",e.position.distanceTo(n)],[`origin: ${e.name||e.type}`,`x:${e.position.x}, y:${e.position.y}, z:${(o=e.position)==null?void 0:o.z}`],[`Destiny: ${e.name||e.type}`,`x:${n.x}, y:${n.y}, z:${n==null?void 0:n.z}`]])},unmounted:e=>{R==null||R.dispose(),e.parent&&e.parent.remove(R)}};class et extends v.Line{constructor(t,n){const r=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new v.BufferGeometry;o.setAttribute("position",new v.Float32BufferAttribute(r,3)),o.computeBoundingSphere();const l=new v.LineBasicMaterial({fog:!1});super(o,l),this.light=t,this.color=n,this.type="RectAreaLightHelper";const s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new v.BufferGeometry;a.setAttribute("position",new v.Float32BufferAttribute(s,3)),a.computeBoundingSphere(),this.add(new v.Mesh(a,new v.MeshBasicMaterial({side:v.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const t=this.material.color,n=Math.max(t.r,t.g,t.b);n>1&&t.multiplyScalar(1/n),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const{logWarning:tt}=G();let le,F;const wn={DirectionalLight:v.DirectionalLightHelper,PointLight:v.PointLightHelper,SpotLight:v.SpotLightHelper,HemisphereLight:v.HemisphereLightHelper,RectAreaLight:et},bn={mounted:e=>{if(!e.isLight){tt(`${e.type} is not a light`);return}le=wn[e.type],e.parent.add(new le(e,1,e.color.getHex()))},updated:e=>{F=e.parent.children.find(t=>t instanceof le),!(F instanceof et)&&F.update()},unmounted:e=>{if(!e.isLight){tt(`${e.type} is not a light`);return}F=e.parent.children.find(t=>t instanceof le),F&&F.dispose&&F.dispose(),e.parent&&e.parent.remove(F)}},Cn={mounted:(e,t)=>{if(t.arg){console.log(`v-log:${t.arg}`,e[t.arg]);return}console.log("v-log",e)}},Mn={install(e){e.component("TresCanvas",Ze)}};w.TresCanvas=Ze,w.UseLoader=ft,w.UseTexture=Et,w.catalogue=re,w.createRenderLoop=Ee,w.default=Mn,w.dispose=fe,w.extend=oe,w.isProd=Rt,w.normalizeColor=$e,w.normalizeVectorFlexibleParam=zt,w.onTresReady=Yt,w.templateCompilerOptions=vn,w.traverseObjects=we,w.useCamera=Ie,w.useLoader=be,w.useLogger=G,w.useLoop=Jt,w.useRaycaster=Ue,w.useRenderLoop=Ht,w.useRenderer=Re,w.useSeek=Zt,w.useTexture=Be,w.useTres=Kt,w.useTresContext=Q,w.useTresContextProvider=We,w.useTresEventManager=Ve,w.vDistanceTo=_n,w.vLightHelper=bn,w.vLog=Cn,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
+(function(w,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("vue"),require("three"),require("@vueuse/core")):typeof define=="function"&&define.amd?define(["exports","vue","three","@vueuse/core"],d):(w=typeof globalThis<"u"?globalThis:w||self,d(w.tres={},w.Vue,w.Three,w.VueUseCore))})(this,function(w,d,v,M){"use strict";var Pn=Object.defineProperty;var Sn=(w,d,v)=>d in w?Pn(w,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[d]=v;var ye=(w,d,v)=>Sn(w,typeof d!="symbol"?d+"":d,v);function ct(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const _e=ct(v),ut={name:"@tresjs/core",type:"module",version:"4.3.3",packageManager:"pnpm@9.15.5",description:"Declarative ThreeJS using Vue Components",author:"Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)",license:"MIT",repository:{type:"git",url:"git+https://github.com/Tresjs/tres.git"},keywords:["vue","3d","threejs","three","threejs-vue"],sideEffects:!1,exports:{".":{types:"./dist/index.d.ts",import:"./dist/tres.js",require:"./dist/tres.umd.cjs"},"./components":{types:"./dist/src/components/index.d.ts"},"./composables":{types:"./dist/src/composables/index.d.ts"},"./types":{types:"./dist/src/types/index.d.ts"},"./utils":{types:"./dist/src/utils/index.d.ts"},"./*":"./*"},main:"./dist/tres.js",module:"./dist/tres.js",types:"./dist/index.d.ts",files:["*.d.ts","dist"],publishConfig:{access:"public"},scripts:{dev:"pnpm --filter='./playground/vue' dev","dev:nuxt":"pnpm --filter='./playground/nuxt' dev",build:"vite build",test:"vitest","test:ci":"vitest run","test:ui":"vitest --ui --coverage.enabled=true",release:"release-it",coverage:"vitest run --coverage",lint:"eslint .","lint:fix":"eslint . --fix","docs:dev":"vitepress dev docs","docs:build":"vitepress build docs","docs:serve":"vitepress serve docs","docs:preview":"vitepress preview docs","docs:contributors":"esno scripts/update-contributors.ts"},peerDependencies:{three:">=0.133",vue:">=3.4"},dependencies:{"@alvarosabu/utils":"^3.2.0","@vue/devtools-api":"^6.6.3","@vueuse/core":"^12.5.0"},devDependencies:{"@release-it/conventional-changelog":"^10.0.0","@stackblitz/sdk":"^1.11.0","@tresjs/cientos":"4.1.0","@tresjs/eslint-config":"^1.4.0","@types/three":"^0.173.0","@typescript-eslint/eslint-plugin":"^8.23.0","@typescript-eslint/parser":"^8.23.0","@vitejs/plugin-vue":"^5.2.1","@vitest/coverage-c8":"^0.33.0","@vitest/coverage-v8":"^3.0.5","@vitest/ui":"^3.0.5","@vue/test-utils":"^2.4.6",eslint:"^9.19.0","eslint-plugin-vue":"^9.32.0",esno:"^4.8.0",gsap:"^3.12.7",jsdom:"^26.0.0",kolorist:"^1.8.0",ohmyfetch:"^0.4.21",pathe:"^2.0.2","release-it":"^18.1.2","rollup-plugin-analyzer":"^4.0.0","rollup-plugin-copy":"^3.5.0","rollup-plugin-visualizer":"^5.14.0",sponsorkit:"^16.3.0",three:"^0.173.0",unocss:"^65.4.3",unplugin:"^2.1.2","unplugin-vue-components":"^28.0.0",vite:"^6.1.0","vite-plugin-banner":"^0.8.0","vite-plugin-dts":"4.5.0","vite-plugin-inspect":"^10.1.0","vite-plugin-require-transform":"^1.0.21","vite-svg-loader":"^5.1.0",vitepress:"1.6.3",vitest:"3.0.5",vue:"3.5.13","vue-demi":"^0.14.10"}};function we(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}async function be(e,t,n,r,o){const{logError:l}=G(),s=new e;return o&&o(s),n&&n(s),await new Promise((a,c)=>{s.load(t,i=>{const f=i;f.scene&&Object.assign(f,we(f.scene)),a(f)},r,i=>{l("[useLoader] - Failed to load resource",i),c(i)})})}const ft=d.defineComponent({__name:"component",props:{loader:{},url:{}},async setup(e){let t,n;const r=e,o=([t,n]=d.withAsyncContext(()=>d.reactive(be(r.loader,r.url))),t=await t,n(),t);return(l,s)=>d.renderSlot(l.$slots,"default",{data:d.unref(o)})}});class dt extends _e.Mesh{constructor(...n){super(...n);ye(this,"type","HightlightMesh");ye(this,"createTime");this.createTime=Date.now()}onBeforeRender(){const r=(Date.now()-this.createTime)/1e3,s=1+.07*Math.sin(2.5*r);this.scale.set(s,s,s)}}function ue(e){return typeof e>"u"}function Z(e){return Array.isArray(e)}function pt(e){return typeof e=="number"}function Ce(e){return typeof e=="string"}function N(e){return typeof e=="function"}function $(e){return e===Object(e)&&!Z(e)&&!N(e)}function V(e){return $(e)&&"isObject3D"in e&&!!e.isObject3D}function Me(e){return $(e)&&"isCamera"in e&&!!e.isCamera}function mt(e){return $(e)&&"isBufferGeometry"in e&&!!e.isBufferGeometry}function ht(e){return $(e)&&"isMaterial"in e&&!!e.isMaterial}function gt(e){return $(e)&&"isLight"in e&&!!e.isLight}function vt(e){return $(e)&&"isFog"in e&&!!e.isFog}function yt(e){return $(e)&&"isScene"in e&&!!e.isScene}function ee(e){return V(e)||mt(e)||ht(e)||vt(e)}function _t(e){return $(e)&&!!e.isPrimitive}const Pe=(e,t)=>{for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],Pe(e[n],t[n]));return Object.assign(e||{},t),e},wt=Mt("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot");function Se(e){return e&&e.nodeType===1}function te(e){return e.replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}const bt=/\B([A-Z])/g;function Ct(e){return e.replace(bt,"-$1").toLowerCase()}function Mt(e,t){const n=Object.create(null),r=e.split(",");for(let o=0;o<r.length;o++)n[r[o]]=!0;return t?o=>!!n[o.toLowerCase()]:o=>!!n[o]}const ke=(e,t)=>{if(!t)return;const n=Array.isArray(t)?t:t.match(/([^[.\]])+/g);return n==null?void 0:n.reduce((r,o)=>r&&r[o],e)},Pt=(e,t,n)=>{const r=Array.isArray(t)?t:t.match(/([^[.\]])+/g);r&&r.reduce((o,l,s)=>(o[l]===void 0&&(o[l]={}),s===r.length-1&&(o[l]=n),o[l]),e)};function Ae(e,t){if(Se(e)&&Se(t)){const o=e.attributes,l=t.attributes;return o.length!==l.length?!1:Array.from(o).every(({name:s,value:a})=>t.getAttribute(s)===a)}if(e===t)return!0;if(e===null||typeof e!="object"||t===null||typeof t!="object")return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(!r.includes(o)||!Ae(e[o],t[o]))return!1;return!0}function St(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ae(e[n],t[n]))return!1;return!0}const kt=Array.isArray;function At(e,t,n,r){const o=c=>{if(c.uuid===t)return c;for(const i of c.children){const f=o(i);if(f)return f}},l=o(e);if(!l){console.warn("Object with UUID not found in the scene.");return}let s=l;for(let c=0;c<n.length-1;c++)if(s[n[c]]!==void 0)s=s[n[c]];else{console.warn(`Property path is not valid: ${n.join(".")}`);return}const a=n[n.length-1];s[a]!==void 0?s[a]=r:console.warn(`Property path is not valid: ${n.join(".")}`)}function Lt(e){const t=new v.MeshBasicMaterial({color:11003607,transparent:!0,opacity:.2,depthTest:!1,side:v.DoubleSide});return new dt(e.geometry.clone(),t)}function Ot(e){var n;let t=e.value;return e.value&&((n=e.value)!=null&&n.isMesh)&&(t=e.value.position),Array.isArray(e.value)&&(t=new v.Vector3(...t)),t}function Dt(e){return"map"in e}function Le(e){Dt(e)&&e.map&&e.map.dispose(),e.dispose()}function fe(e){var n,r;if(e.parent&&((n=e.removeFromParent)==null||n.call(e)),delete e.__tres,[...e.children].forEach(o=>fe(o)),!(e instanceof v.Scene)){const o=e;e&&((r=e.dispose)==null||r.call(e)),o.geometry&&o.geometry.dispose(),Array.isArray(o.material)?o.material.forEach(l=>Le(l)):o.material&&Le(o.material)}}function jt(e,t){let n=0;for(let r=0;r<e.length;r++)t(e[r],r)&&(e[n]=e[r],n++);return e.length=n,e}function de(e,t){let n=e;if(t.includes("-")){const r=t.split("-");let o=r.shift();for(;n&&r.length;)o in n?(n=n[o],o=r.shift()):o=Oe(o,r.shift());return{target:n,key:Oe(o,...r)}}else return{target:n,key:t}}function Oe(...e){return e.map((t,n)=>n===0?t:t.charAt(0).toUpperCase()+t.slice(1)).join("")}const De=/-\d+$/;function Tt(e,t,n){if(Ce(n)){if(De.test(n)){const l=n.replace(De,""),{target:s,key:a}=de(e,l);if(!Array.isArray(s[a])){const c=s[a],i=[];i.__tresDetach=()=>{i.every(f=>ue(f))&&(s[a]=c)},s[a]=i}}const{target:r,key:o}=de(e,n);t.__tres.previousAttach=r[o],r[o]=q(t)}else t.__tres.previousAttach=n(e,t)}function xt(e,t,n){var r,o,l;if(Ce(n)){const{target:s,key:a}=de(e,n),c=t.__tres.previousAttach;c===void 0?delete s[a]:s[a]=c,"__tresDetach"in s&&s.__tresDetach()}else(o=(r=t.__tres)==null?void 0:r.previousAttach)==null||o.call(r,e,t);(l=t.__tres)==null||delete l.previousAttach}function z(e,t,n){const r=e;return r.__tres={type:"unknown",eventCount:0,root:n,handlers:{},memoizedProps:{},objects:[],parent:null,previousAttach:null,...t},r.__tres.attach||(r.isMaterial?r.__tres.attach="material":r.isBufferGeometry?r.__tres.attach="geometry":r.isFog&&(r.__tres.attach="fog")),r}function je(e){var n;const t=(n=e==null?void 0:e.__tres)==null?void 0:n.root;t&&t.render&&t.render.canBeInvalidated.value&&t.invalidate()}function Yn(e){}function Bt(e,t,n){var o;if(!N(e.setPixelRatio))return;let r=0;if(n&&Z(n)){const l=n;if(l.length>=2){const[s,a]=l;r=v.MathUtils.clamp(t,s,a)}}else pt(n)?r=n:r=t;r!==((o=e.getPixelRatio)==null?void 0:o.call(e))&&e.setPixelRatio(r)}function It(e,t,n,r,o){const l=[...t.__tres.objects],s=q(t);if(e=q(e),s===e)return!0;const a=z(e,t.__tres??{},o),c=t.parent??t.__tres.parent??null,i={...t.__tres.memoizedProps};delete i.object;for(const f of l)Te(f,o),xe(f,o);s.__tres.objects=[],r.remove(t);for(const[f,y]of Object.entries(i))r.patchProp(a,f,a[f],y);n(e),r.insert(t,c);for(const f of l)r.insert(f,t);return!0}function q(e){return _t(e)?(e.object.__tres=e.__tres,e.object):e}function Te(e,t){var r,o,l,s;const n=((r=e.__tres)==null?void 0:r.parent)||t.scene.value;e.__tres&&(e.__tres.parent=null),n&&n.__tres&&"objects"in n.__tres&&jt(n.__tres.objects,a=>a!==e),(o=e.__tres)!=null&&o.attach?xt(n,e,e.__tres.attach):((s=(l=e.parent)==null?void 0:l.remove)==null||s.call(l,q(e)),e.parent=null)}function xe(e,t){var n;(n=e.traverse)==null||n.call(e,r=>{var o;t.deregisterCamera(r),(o=t.eventManager)==null||o.deregisterPointerMissedObject(r)}),t.deregisterCamera(e),je(e)}async function Be(e,t){const n=new v.TextureLoader(t),r=o=>new Promise((l,s)=>{n.load(o,a=>l(a),()=>null,()=>{s(new Error("[useTextures] - Failed to load texture"))})});if(kt(e)){const o=await Promise.all(e.map(l=>r(l)));return e.length>1?o:o[0]}else{const{map:o,displacementMap:l,normalMap:s,roughnessMap:a,metalnessMap:c,aoMap:i,alphaMap:f,matcap:y}=e;return{map:o?await r(o):null,displacementMap:l?await r(l):null,normalMap:s?await r(s):null,roughnessMap:a?await r(a):null,metalnessMap:c?await r(c):null,aoMap:i?await r(i):null,alphaMap:f?await r(f):null,matcap:y?await r(y):null}}}const Et=d.defineComponent({__name:"component",props:{map:{},displacementMap:{},normalMap:{},roughnessMap:{},metalnessMap:{},aoMap:{},alphaMap:{},matcap:{}},async setup(e){let t,n;const r=e,o=([t,n]=d.withAsyncContext(()=>d.reactive(Be(r))),t=await t,n(),t);return(l,s)=>d.renderSlot(l.$slots,"default",{textures:d.unref(o)})}}),Ie=({sizes:e})=>{const t=d.ref([]),n=d.computed(()=>t.value[0]),r=s=>{const a=s instanceof v.Camera?s:t.value.find(i=>i.uuid===s);if(!a)return;const c=t.value.filter(({uuid:i})=>i!==a.uuid);t.value=[a,...c]},o=(s,a=!1)=>{if(Me(s)){const c=s;if(t.value.some(({uuid:i})=>i===c.uuid))return;a?r(c):t.value.push(c)}},l=s=>{if(Me(s)){const a=s;t.value=t.value.filter(({uuid:c})=>c!==a.uuid)}};return d.watchEffect(()=>{e.aspectRatio.value&&t.value.forEach(s=>{!s.manual&&(s instanceof v.PerspectiveCamera||$t(s))&&(s instanceof v.PerspectiveCamera?s.aspect=e.aspectRatio.value:(s.left=e.width.value*-.5,s.right=e.width.value*.5,s.top=e.height.value*.5,s.bottom=e.height.value*-.5),s.updateProjectionMatrix())})}),d.onUnmounted(()=>{t.value=[]}),{camera:n,cameras:t,registerCamera:o,deregisterCamera:l,setCameraActive:r}};function $t(e){return e.hasOwnProperty("isOrthographicCamera")&&e.isOrthographicCamera}const Rt=!0,ne="[TresJS ▲ ■ ●] ";function Ut(...e){typeof e[0]=="string"?e[0]=ne+e[0]:e.unshift(ne),console.error(...e)}function Vt(...e){typeof e[0]=="string"?e[0]=ne+e[0]:e.unshift(ne),console.warn(...e)}function Ft(e,t){}function G(){return{logError:Ut,logWarning:Vt,logMessage:Ft}}const re=d.ref({}),oe=e=>Object.assign(re.value,e);function pe(){const e=new Map,t=new Set;let n=0,r=!1;const o=()=>{const i=Array.from(e.entries()).sort((f,y)=>{const u=f[1].priority-y[1].priority;return u===0?f[1].addI-y[1].addI:u});t.clear(),i.forEach(f=>t.add(f[0]))},l=i=>{e.delete(i),t.delete(i)};return{on:(i,f=0)=>{e.set(i,{priority:f,addI:n++});const y=()=>l(i);return M.tryOnScopeDispose(y),r=!0,{off:y}},off:l,trigger:(...i)=>{r&&(o(),r=!1),t.forEach(f=>f(...i))},dispose:()=>{e.clear(),t.clear()},get count(){return e.size}}}function Ee(){let e=!0,t=!0,n=!1;const r=new v.Clock(!1),o=d.ref(r.running),l=d.ref(!1);let s;const a=v.MathUtils.generateUUID();let c=null;const i=pe(),f=pe(),y=pe();j();let u={};function b(k){u=k}function m(k,T,h=0){switch(T){case"before":return i.on(k,h);case"render":return c||(c=k),f.dispose(),f.on(k);case"after":return y.on(k,h)}}function C(){t&&(t=!1,j(),O())}function p(){t=!0,j(),cancelAnimationFrame(s)}function _(){n=!1,j()}function A(){n=!0,j()}function L(){l.value=!0}function P(){l.value=!1}function O(){if(!e){s=requestAnimationFrame(O);return}const k=r.getDelta(),T=r.getElapsedTime(),h={camera:d.unref(u.camera),scene:d.unref(u.scene),renderer:d.unref(u.renderer),raycaster:d.unref(u.raycaster),controls:d.unref(u.controls),invalidate:u.invalidate,advance:u.advance},S={delta:k,elapsed:T,clock:r,...h};o.value&&i.trigger(S),l.value||(f.count?f.trigger(S):c&&c(S)),o.value&&y.trigger(S),s=requestAnimationFrame(O)}function j(){const k=!t&&!n;r.running!==k&&(r.running?r.stop():r.start()),o.value=r.running}return{loopId:a,register:(k,T,h)=>m(k,T,h),start:C,stop:p,pause:A,resume:_,pauseRender:L,resumeRender:P,isRenderPaused:l,isActive:o,setContext:b,setReady:k=>e=k}}function me(e){let t=0;return e.traverse(n=>{if(n.isMesh&&n.geometry&&n.type!=="HightlightMesh"){const r=n.geometry,o=r.attributes.position.count*3*Float32Array.BYTES_PER_ELEMENT,l=r.index?r.index.count*Uint32Array.BYTES_PER_ELEMENT:0,s=r.attributes.normal?r.attributes.normal.count*3*Float32Array.BYTES_PER_ELEMENT:0,a=r.attributes.uv?r.attributes.uv.count*2*Float32Array.BYTES_PER_ELEMENT:0,c=o+l+s+a;t+=c}}),t}function Wt(e){return(e/1024).toFixed(2)}const Nt=Number.parseInt(v.REVISION.replace("dev",""));function zt(e){return typeof e=="number"?[e,e,e]:e instanceof v.Vector3?[e.x,e.y,e.z]:e}function $e(e){return e instanceof v.Color?e:Array.isArray(e)?new v.Color(...e):new v.Color(e)}const se={realistic:{shadows:!0,physicallyCorrectLights:!0,outputColorSpace:v.SRGBColorSpace,toneMapping:v.ACESFilmicToneMapping,toneMappingExposure:3,shadowMap:{enabled:!0,type:v.PCFSoftShadowMap}},flat:{toneMapping:v.NoToneMapping,toneMappingExposure:1}};function Re({canvas:e,options:t,contextParts:{sizes:n,render:r,invalidate:o,advance:l}}){const s=d.computed(()=>({alpha:M.toValue(t.alpha)??!0,depth:M.toValue(t.depth),canvas:M.unrefElement(e),context:M.toValue(t.context),stencil:M.toValue(t.stencil),antialias:M.toValue(t.antialias)??!0,precision:M.toValue(t.precision),powerPreference:M.toValue(t.powerPreference),premultipliedAlpha:M.toValue(t.premultipliedAlpha),preserveDrawingBuffer:M.toValue(t.preserveDrawingBuffer),logarithmicDepthBuffer:M.toValue(t.logarithmicDepthBuffer),failIfMajorPerformanceCaveat:M.toValue(t.failIfMajorPerformanceCaveat)})),a=d.shallowRef(new v.WebGLRenderer(s.value));function c(){t.renderMode==="on-demand"&&o()}d.watch(s,()=>{a.value.dispose(),a.value=new v.WebGLRenderer(s.value),c()}),d.watch([n.width,n.height],()=>{a.value.setSize(n.width.value,n.height.value),c()},{immediate:!0}),d.watch(()=>t.clearColor,c);const{pixelRatio:i}=M.useDevicePixelRatio(),{logError:f}=G(),u=(()=>{const m=new v.WebGLRenderer,C={shadowMap:{enabled:m.shadowMap.enabled,type:m.shadowMap.type},toneMapping:m.toneMapping,toneMappingExposure:m.toneMappingExposure,outputColorSpace:m.outputColorSpace};return m.dispose(),C})(),b=M.toValue(t.renderMode);return b==="on-demand"&&o(),b==="manual"&&setTimeout(()=>{l()},100),d.watchEffect(()=>{const m=M.toValue(t.preset);m&&(m in se||f(`Renderer Preset must be one of these: ${Object.keys(se).join(", ")}`),Pe(a.value,se[m])),Bt(a.value,i.value,M.toValue(t.dpr)),b==="always"&&(r.frames.value=Math.max(1,r.frames.value));const C=(A,L)=>{const P=M.toValue(A),O=()=>{if(m)return ke(se[m],L)};if(P!==void 0)return P;const j=O();return j!==void 0?j:ke(u,L)},p=(A,L)=>Pt(a.value,L,C(A,L));p(t.shadows,"shadowMap.enabled"),p(t.toneMapping??v.ACESFilmicToneMapping,"toneMapping"),p(t.shadowMapType,"shadowMap.type"),Nt<150&&p(!t.useLegacyLights,"physicallyCorrectLights"),p(t.outputColorSpace,"outputColorSpace"),p(t.toneMappingExposure,"toneMappingExposure");const _=C(t.clearColor,"clearColor");_&&a.value.setClearColor(_?$e(_):new v.Color(0))}),d.onUnmounted(()=>{a.value.dispose(),a.value.forceContextLoss()}),{renderer:a}}function Gt(e,t,n=10){const {width}=M.useWindowSize();const r=M.toValue(e)?{width,height:d.ref(window.screen.availHeight)}:M.useElementSize(d.computed(()=>M.toValue(t).parentElement)),o=d.readonly(M.refDebounced(r.width,n)),l=d.readonly(M.refDebounced(r.height,n)),s=d.computed(()=>o.value/l.value);return{height:l,width:o,aspectRatio:s}}const Ue=(e,t)=>{const n=d.computed(()=>t.renderer.value.domElement),r=d.shallowRef([]),{x:o,y:l}=M.usePointer({target:n});let s=0;const{width:a,height:c,top:i,left:f}=M.useElementBounding(n),y=({x:g,y:D})=>{if(n.value)return{x:(g-f.value)/a.value*2-1,y:-((D-i.value)/c.value)*2+1}},u=({x:g,y:D})=>{if(t.camera.value)return t.raycaster.value.setFromCamera(new v.Vector2(g,D),t.camera.value),r.value=t.raycaster.value.intersectObjects(e.value,!0),r.value},b=g=>{const D=y({x:(g==null?void 0:g.clientX)??o.value,y:(g==null?void 0:g.clientY)??l.value});return D?u(D)||[]:[]},m=M.createEventHook(),C=M.createEventHook(),p=M.createEventHook(),_=M.createEventHook(),A=M.createEventHook(),L=M.createEventHook(),P=M.createEventHook(),O=M.createEventHook();function j(g){const D={};for(const W in g)typeof W!="function"&&(D[W]=g[W]);return D}const k=(g,D)=>{var it,at,lt;const W=j(D),ce=new v.Vector3(D==null?void 0:D.clientX,D==null?void 0:D.clientY,0).unproject((it=t.camera)==null?void 0:it.value);g.trigger({...W,intersections:r.value,unprojectedPoint:ce,ray:(at=t.raycaster)==null?void 0:at.value.ray,camera:(lt=t.camera)==null?void 0:lt.value,sourceEvent:D,delta:s,stopPropagating:!1})};let T;const h=g=>{b(g),k(p,g),T=g},S=()=>{T&&h(T)};let x,B,I;const U=g=>{var D;x=(D=r.value[0])==null?void 0:D.object,s=0,B=new v.Vector2((g==null?void 0:g.clientX)??o.value,(g==null?void 0:g.clientY)??l.value),k(A,g)};let E,K=!1;const nt=g=>{var D,W,ce;g instanceof PointerEvent&&(r.value.length===0&&k(L,g),x===((D=r.value[0])==null?void 0:D.object)&&(I=new v.Vector2((g==null?void 0:g.clientX)??o.value,(g==null?void 0:g.clientY)??l.value),s=B==null?void 0:B.distanceTo(I),g.button===0?(k(m,g),E===((W=r.value[0])==null?void 0:W.object)?K=!0:(E=(ce=r.value[0])==null?void 0:ce.object,K=!1)):g.button===2&&k(P,g)),k(_,g))},rt=g=>{K&&(k(C,g),E=void 0,K=!1)},ot=g=>k(p,g),st=g=>k(O,g);return n.value.addEventListener("pointerup",nt),n.value.addEventListener("pointerdown",U),n.value.addEventListener("pointermove",h),n.value.addEventListener("pointerleave",ot),n.value.addEventListener("dblclick",rt),n.value.addEventListener("wheel",st),d.onUnmounted(()=>{n!=null&&n.value&&(n.value.removeEventListener("pointerup",nt),n.value.removeEventListener("pointerdown",U),n.value.removeEventListener("pointermove",h),n.value.removeEventListener("pointerleave",ot),n.value.removeEventListener("dblclick",rt),n.value.removeEventListener("wheel",st))}),{intersects:r,onClick:g=>m.on(g).off,onDblClick:g=>C.on(g).off,onContextMenu:g=>P.on(g).off,onPointerMove:g=>p.on(g).off,onPointerUp:g=>_.on(g).off,onPointerDown:g=>A.on(g).off,onPointerMissed:g=>L.on(g).off,onWheel:g=>O.on(g).off,forceUpdate:S}};function he(e,t){if(Array.isArray(e))for(const n of e)n(t);typeof e=="function"&&e(t)}function Ve(e,t,n){var T;const r=d.shallowRef(),o=d.shallowRef();e&&(r.value=e),t&&(o.value=t);const l=h=>{var S;return((S=h.__tres)==null?void 0:S.eventCount)>0},s=h=>{var S;return((S=h.children)==null?void 0:S.some(x=>s(x)))||l(h)},a=d.shallowRef(((T=r.value)==null?void 0:T.children).filter(s)||[]);function c(h,S){const x=[],B=()=>S.stopPropagating=!0;S.stopPropagation=B;for(const I of S==null?void 0:S.intersections){if(S.stopPropagating)return;S={...S,...I};const{object:U}=I;S.eventObject=U,he(U[h],S),x.push(U);let E=U.parent;for(;E!==null&&!S.stopPropagating&&!x.includes(E);)S.eventObject=E,he(E[h],S),x.push(E),E=E.parent;const K=Ct(h.slice(2));n(K,{intersection:I,event:S})}}const{onClick:i,onDblClick:f,onContextMenu:y,onPointerMove:u,onPointerDown:b,onPointerUp:m,onPointerMissed:C,onWheel:p,forceUpdate:_}=Ue(a,t);m(h=>c("onPointerUp",h)),b(h=>c("onPointerDown",h)),i(h=>c("onClick",h)),f(h=>c("onDoubleClick",h)),y(h=>c("onContextMenu",h)),p(h=>c("onWheel",h));let A=[];u(h=>{const S=h.intersections.map(({object:B})=>B),x=h.intersections;A.forEach(({object:B})=>{S.includes(B)||(h.intersections=A,c("onPointerLeave",h),c("onPointerOut",h))}),h.intersections=x,h.intersections.forEach(({object:B})=>{A.includes(B)||(c("onPointerEnter",h),c("onPointerOver",h))}),c("onPointerMove",h),A=h.intersections});const L=[];C(h=>{const S=()=>h.stopPropagating=!0;h.stopPropagation=S,L.forEach(x=>{h.stopPropagating||(h.eventObject=x,he(x.onPointerMissed,h))}),n("pointer-missed",{event:h})});function P(h){ee(h)&&V(h)&&a.value.push(h)}function O(h){if(ee(h)&&V(h)){const S=a.value.indexOf(h);S>-1&&a.value.splice(S,1)}}function j(h){ee(h)&&V(h)&&h.onPointerMissed&&L.push(h)}function k(h){if(ee(h)&&V(h)){const S=L.indexOf(h);S>-1&&L.splice(S,1)}}return t.eventManager={forceUpdate:_,registerObject:P,deregisterObject:O,registerPointerMissedObject:j,deregisterPointerMissedObject:k},{forceUpdate:_,registerObject:P,deregisterObject:O,registerPointerMissedObject:j,deregisterPointerMissedObject:k}}function qt(e,t,n=100){n=n<=0?100:n;const r=M.createEventHook(),o=new Set;let l=!1,s=!1,a=null;function c(){a&&clearTimeout(a),!s&&!l&&e()?(r.trigger(t),o.forEach(u=>u()),o.clear(),l=!0):!s&&!l&&(a=setTimeout(c,n))}function i(){s=!0,a&&clearTimeout(a)}c();const f=(u,...b)=>{u(...b)};return{on:u=>{if(l)return f(u,t),{off:()=>{}};{const b=r.on(u);return o.add(b.off),r.on(u)}},off:r.off,trigger:r.trigger,clear:r.clear,cancel:i}}const J=new WeakMap;function Fe(e){if(e=e||Q(),J.has(e))return J.get(e);const t=100,n=Date.now(),l=qt(()=>{if(Date.now()-n>=t)return!0;{const s=e.renderer.value,a=(s==null?void 0:s.domElement)||{width:0,height:0};return!!(s&&a.width>0&&a.height>0)}},e);return J.set(e,l),l}function Yt(e){const t=Q();if(t)return J.has(t)?J.get(t).on(e):Fe(t).on(e)}function We({scene:e,canvas:t,windowSize:n,rendererOptions:r,emit:o}){const l=d.shallowRef(e),s=Gt(n,t),{camera:a,cameras:c,registerCamera:i,deregisterCamera:f,setCameraActive:y}=Ie({sizes:s}),u={mode:d.ref(r.renderMode||"always"),priority:d.ref(0),frames:d.ref(0),maxFrames:60,canBeInvalidated:d.computed(()=>u.mode.value==="on-demand"&&u.frames.value===0)};function b(I=1){r.renderMode==="on-demand"&&(u.frames.value=Math.min(u.maxFrames,u.frames.value+I))}function m(){r.renderMode==="manual"&&(u.frames.value=1)}const{renderer:C}=Re({canvas:t,options:r,contextParts:{sizes:s,render:u,invalidate:b,advance:m}}),p={sizes:s,scene:l,camera:a,cameras:d.readonly(c),renderer:C,raycaster:d.shallowRef(new v.Raycaster),controls:d.ref(null),perf:{maxFrames:160,fps:{value:0,accumulator:[]},memory:{currentMem:0,allocatedMem:0,accumulator:[]}},render:u,advance:m,extend:oe,invalidate:b,registerCamera:i,setCameraActive:y,deregisterCamera:f,loop:Ee()};d.provide("useTres",p),p.scene.value.__tres={root:p},p.loop.register(()=>{a.value&&u.frames.value>0&&(C.value.render(e,a.value),o("render",p.renderer.value)),u.priority.value=0,u.mode.value==="always"?u.frames.value=1:u.frames.value=Math.max(0,u.frames.value-1)},"render");const{on:_,cancel:A}=Fe(p);p.loop.setReady(!1),p.loop.start(),_(()=>{o("ready",p),p.loop.setReady(!0),Ve(e,p,o)}),d.onUnmounted(()=>{A(),p.loop.stop()});const L=100,P=M.useFps({every:L}),{isSupported:O,memory:j}=M.useMemory({interval:L}),k=160;let T=performance.now();const h=({timestamp:I})=>{p.scene.value&&(p.perf.memory.allocatedMem=me(p.scene.value)),I-T>=L&&(T=I,p.perf.fps.accumulator.push(P.value),p.perf.fps.accumulator.length>k&&p.perf.fps.accumulator.shift(),p.perf.fps.value=P.value,O.value&&j.value&&(p.perf.memory.accumulator.push(j.value.usedJSHeapSize/1024/1024),p.perf.memory.accumulator.length>k&&p.perf.memory.accumulator.shift(),p.perf.memory.currentMem=p.perf.memory.accumulator.reduce((U,E)=>U+E,0)/p.perf.memory.accumulator.length))};let S=0;const x=1,{pause:B}=M.useRafFn(({delta:I})=>{window.__TRES__DEVTOOLS__&&(h({timestamp:performance.now()}),S+=I,S>=x&&(window.__TRES__DEVTOOLS__.cb(p),S=0))},{immediate:!0});return d.onUnmounted(()=>{B()}),p}function Q(){const e=d.inject("useTres");if(!e)throw new Error("useTresContext must be used together with useTresContextProvider");return e}const Kt=Q;function Jt(){const{camera:e,scene:t,renderer:n,loop:r,raycaster:o,controls:l,invalidate:s,advance:a}=Q();r.setContext({camera:e,scene:t,renderer:n,raycaster:o,controls:l,invalidate:s,advance:a});function c(y,u=0){return r.register(y,"before",u)}function i(y){return r.register(y,"render")}function f(y,u=0){return r.register(y,"after",u)}return{pause:r.pause,resume:r.resume,pauseRender:r.pauseRender,resumeRender:r.resumeRender,isActive:r.isActive,onBeforeRender:c,render:i,onAfterRender:f}}const Ne=M.createEventHook(),ze=M.createEventHook(),ge=M.createEventHook(),X=new v.Clock;let ie=0,ae=0;const{pause:Qt,resume:Ge,isActive:Xt}=M.useRafFn(()=>{Ne.trigger({delta:ie,elapsed:ae,clock:X}),ze.trigger({delta:ie,elapsed:ae,clock:X}),ge.trigger({delta:ie,elapsed:ae,clock:X})},{immediate:!1});ge.on(()=>{ie=X.getDelta(),ae=X.getElapsedTime()});let qe=!1;const Ht=()=>(qe||(qe=!0,Ge()),{onBeforeLoop:Ne.on,onLoop:ze.on,onAfterLoop:ge.on,pause:Qt,resume:Ge,isActive:Xt});function Zt(){const{logWarning:e}=G();function t(l,s,a){let c=null;return l.traverse(i=>{i[s]===a&&(c=i)}),c||e(`Child with ${s} '${a}' not found.`),c}function n(l,s,a){const c=[];return l.traverse(i=>{i[s].includes(a)&&c.push(i)}),c.length||e(`Children with ${s} '${a}' not found.`),c}function r(l,s){return t(l,"name",s)}function o(l,s){return n(l,"name",s)}return{seek:t,seekByName:r,seekAll:n,seekAllByName:o}}function en(e,t={},n={}){let r=e;const o=a=>{r=a};let l=new Proxy({},{});const s={has(a,c){return c in t||c in r},get(a,c,i){return c in t?t[c](r):r[c]},set(a,c,i){const f=n[c];return f&&typeof f=="function"?f(i,r,l,o):r[c]=i,!0}};return l=new Proxy({},s),l}const{logError:Ye}=G(),Ke=["onClick","onContextMenu","onPointerMove","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onDoubleClick","onPointerDown","onPointerUp","onPointerCancel","onPointerMissed","onLostPointerCapture","onWheel"],tn=e=>{const t=e.scene.value;function n(i,f,y,u){if(u||(u={}),u.args||(u.args=[]),i==="template"||wt(i))return null;let b=i.replace("Tres",""),m;if(i==="primitive"){(!$(u.object)||d.isRef(u.object))&&Ye("Tres primitives need an 'object' prop, whose value is an object or shallowRef<object>"),b=u.object.type;const C={};m=en(u.object,{object:_=>_,isPrimitive:()=>!0,__tres:()=>C},{object:(_,A,L,P)=>{It(_,L,P,{patchProp:l,remove:o,insert:r},e)},__tres:_=>{Object.assign(C,_)}})}else{const C=re.value[b];C||Ye(`${b} is not defined on the THREE namespace. Use extend to add it to the catalog.`),m=new C(...u.args)}return m?(m.isCamera&&(u!=null&&u.position||m.position.set(3,3,3),u!=null&&u.lookAt||m.lookAt(0,0,0)),m=z(m,{...m.__tres,type:b,memoizedProps:u,eventCount:0,primitive:i==="primitive",attach:u.attach},e),m):null}function r(i,f){var b,m,C;if(!i)return;f=f||t;const y=i.__tres?i:z(i,{},e),u=f.__tres?f:z(f,{},e);i=q(y),f=q(u),i.__tres&&((b=i.__tres)==null?void 0:b.eventCount)>0&&((m=e.eventManager)==null||m.registerObject(i)),e.registerCamera(i),(C=e.eventManager)==null||C.registerPointerMissedObject(i),y.__tres.attach?Tt(u,y,y.__tres.attach):V(i)&&V(u)&&(u.add(i),i.dispatchEvent({type:"added"})),y.__tres.parent=u,u.__tres.objects&&!u.__tres.objects.includes(y)&&u.__tres.objects.push(y)}function o(i,f){var m,C,p,_;if(!i)return;i!=null&&i.__tres&&((m=i.__tres)==null?void 0:m.eventCount)>0&&((C=e.eventManager)==null||C.deregisterObject(i)),f=ue(f)?"default":f;const y=(p=i.__tres)==null?void 0:p.dispose;ue(y)||(y===null?f=!1:f=y);const u=(_=i.__tres)==null?void 0:_.primitive,b=f==="default"?!u:!!f;if(i.__tres&&"objects"in i.__tres&&[...i.__tres.objects].forEach(A=>o(A,f)),b&&i.children&&[...i.children].forEach(A=>o(A,f)),Te(i,e),xe(i,e),b&&!yt(i)){if(N(f))f(i);else if(N(i.dispose))try{i.dispose()}catch{}}"__tres"in i&&delete i.__tres}function l(i,f,y,u){var A,L;if(!i)return;let b=i,m=f;if(i.__tres&&(i.__tres.memoizedProps[f]=u),f==="attach"){const P=((A=i.__tres)==null?void 0:A.parent)||i.parent;o(i),z(i,{attach:u},e),P&&r(i,P);return}if(f==="dispose"){i.__tres||(i=z(i,{},e)),i.__tres.dispose=u;return}if(V(i)&&m==="blocks-pointer-events"){u||u===""?i[m]=u:delete i[m];return}Ke.includes(f)&&i.__tres&&(i.__tres.eventCount+=1);let C=te(m),p=b==null?void 0:b[C];if(m==="args"){const P=i,O=y??[],j=u??[],k=((L=i.__tres)==null?void 0:L.type)||i.type;k&&O.length&&!St(O,j)&&(b=Object.assign(P,new re.value[k](...u)));return}if(b.type==="BufferGeometry"){if(m==="args")return;b.setAttribute(te(m),new v.BufferAttribute(...u));return}if(m.includes("-")&&p===void 0){const P=m.split("-");p=P.reduce((O,j)=>O[te(j)],b),m=P.pop(),C=m,p!=null&&p.set||(b=P.reduce((O,j)=>O[te(j)],b))}let _=u;if(_===""&&(_=!0),N(p)){Ke.includes(f)||(Z(_)?i[C](..._):i[C](_)),C.startsWith("on")&&N(_)&&(b[C]=_);return}!(p!=null&&p.set)&&!N(p)?b[C]=_:p.constructor===_.constructor&&(p!=null&&p.copy)?p==null||p.copy(_):Z(_)?p.set(..._):!p.isColor&&p.setScalar?p.setScalar(_):p.set(_),je(i)}function s(i){var f;return((f=i==null?void 0:i.__tres)==null?void 0:f.parent)||null}function a(i){const f=z(new v.Object3D,{type:"Comment"},e);return f.name=i,f}function c(i){var b;const f=s(i),y=((b=f==null?void 0:f.__tres)==null?void 0:b.objects)||[],u=y.indexOf(i);return u<0||u>=y.length-1?null:y[u+1]}return{insert:r,remove:o,createElement:n,patchProp:l,parentNode:s,createText:()=>void 0,createComment:a,setText:()=>void 0,setElementText:()=>void 0,nextSibling:c,querySelector:()=>void 0,setScopeId:()=>void 0,cloneNode:()=>void 0,insertStaticContent:()=>void 0}};function nn(){return Je().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Je(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const rn=typeof Proxy=="function",on="devtools-plugin:setup",sn="plugin:settings:set";let Y,ve;function an(){var e;return Y!==void 0||(typeof window<"u"&&window.performance?(Y=!0,ve=window.performance):typeof globalThis<"u"&&(!((e=globalThis.perf_hooks)===null||e===void 0)&&e.performance)?(Y=!0,ve=globalThis.perf_hooks.performance):Y=!1),Y}function ln(){return an()?ve.now():Date.now()}class cn{constructor(t,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=n;const r={};if(t.settings)for(const s in t.settings){const a=t.settings[s];r[s]=a.defaultValue}const o=`__vue-devtools-plugin-settings__${t.id}`;let l=Object.assign({},r);try{const s=localStorage.getItem(o),a=JSON.parse(s);Object.assign(l,a)}catch{}this.fallbacks={getSettings(){return l},setSettings(s){try{localStorage.setItem(o,JSON.stringify(s))}catch{}l=s},now(){return ln()}},n&&n.on(sn,(s,a)=>{s===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(s,a)=>this.target?this.target.on[a]:(...c)=>{this.onQueue.push({method:a,args:c})}}),this.proxiedTarget=new Proxy({},{get:(s,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...c)=>(this.targetQueue.push({method:a,args:c,resolve:()=>{}}),this.fallbacks[a](...c)):(...c)=>new Promise(i=>{this.targetQueue.push({method:a,args:c,resolve:i})})})}async setRealTarget(t){this.target=t;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(await this.target[n.method](...n.args))}}function un(e,t){const n=e,r=Je(),o=nn(),l=rn&&n.enableEarlyProxy;if(o&&(r.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!l))o.emit(on,e,t);else{const s=l?new cn(n,o):null;(r.__VUE_DEVTOOLS_PLUGINS__=r.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:s}),s&&t(s.proxiedTarget)}}function fn(e,t){const n=`▲ ■ ●${e}`;typeof Qe=="function"?Qe(n,t):console.log(n)}function Qe(e,t){throw new Error(e+t)}const Xe=e=>{const t={id:e.uuid,label:e.type,children:[],tags:[]};e.name!==""&&t.tags.push({label:e.name,textColor:5750629,backgroundColor:15793395});const n=me(e);return n>0&&t.tags.push({label:`${Wt(n)} KB`,textColor:15707189,backgroundColor:16775644,tooltip:"Memory usage"}),e.type.includes("Light")&&(gt(e)&&t.tags.push({label:`${e.intensity}`,textColor:9738662,backgroundColor:16316922,tooltip:"Intensity"}),t.tags.push({label:`#${new v.Color(e.color).getHexString()}`,textColor:9738662,backgroundColor:16316922,tooltip:"Color"})),e.type.includes("Camera")&&(t.tags.push({label:`${e.fov}°`,textColor:9738662,backgroundColor:16316922,tooltip:"Field of view"}),t.tags.push({label:`x: ${Math.round(e.position.x)} y: ${Math.round(e.position.y)} z: ${Math.round(e.position.z)}`,textColor:9738662,backgroundColor:16316922,tooltip:"Position"})),t};function He(e,t,n=""){e.children.forEach(r=>{if(r.type==="HightlightMesh"||n&&!r.type.includes(n)&&!r.name.includes(n))return;const o=Xe(r);t.children.push(o),He(r,o,n)})}const dn=[],H="tres:inspector",pn=d.reactive({sceneGraph:null});function mn(e,t){un({id:"dev.esm.tres",label:"TresJS 🪐",logo:"https://raw.githubusercontent.com/Tresjs/tres/main/public/favicon.svg",packageName:"tresjs",homepage:"https://tresjs.org",componentStateTypes:dn,app:e},n=>{typeof n.now!="function"&&fn("You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html."),n.addInspector({id:H,label:"TresJS 🪐",icon:"account_tree",treeFilterPlaceholder:"Search instances"}),setInterval(()=>{n.sendInspectorTree(H)},1e3),setInterval(()=>{n.notifyComponentUpdate()},5e3),n.on.getInspectorTree(l=>{if(l.inspectorId===H){const s=Xe(t.scene.value);He(t.scene.value,s,l.filter),pn.sceneGraph=s,l.rootNodes=[s]}});let r=null,o=null;n.on.getInspectorState(l=>{var s;if(l.inspectorId===H){const[a]=t.scene.value.getObjectsByProperty("uuid",l.nodeId);if(!a)return;if(o&&r&&r.parent&&o.remove(r),a.isMesh){const c=Lt(a);a.add(c),r=c,o=a}l.state={object:Object.entries(a).map(([c,i])=>c==="children"?{key:c,value:i.filter(f=>f.type!=="HightlightMesh")}:{key:c,value:i,editable:!0}).filter(({key:c})=>c!=="parent")},a.isScene&&(l.state={...l.state,state:[{key:"Scene Info",value:{objects:a.children.length,memory:me(a),calls:t.renderer.value.info.render.calls,triangles:t.renderer.value.info.render.triangles,points:t.renderer.value.info.render.points,lines:t.renderer.value.info.render.lines}},{key:"Programs",value:((s=t.renderer.value.info.programs)==null?void 0:s.map(c=>({...c,programName:c.name})))||[]}]})}}),n.on.editInspectorState(l=>{l.inspectorId===H&&At(t.scene.value,l.nodeId,l.path,l.state.value)})})}const hn=["data-scene","data-tres"],Ze=d.defineComponent({__name:"TresCanvas",props:{shadows:{type:Boolean,default:void 0},clearColor:{},toneMapping:{},shadowMapType:{},useLegacyLights:{type:Boolean,default:void 0},outputColorSpace:{},toneMappingExposure:{},renderMode:{default:"always"},dpr:{},camera:{},preset:{},windowSize:{type:Boolean,default:void 0},enableProvideBridge:{type:Boolean,default:!0},context:{},alpha:{type:Boolean,default:void 0},premultipliedAlpha:{type:Boolean},antialias:{type:Boolean,default:void 0},stencil:{type:Boolean,default:void 0},preserveDrawingBuffer:{type:Boolean,default:void 0},powerPreference:{},depth:{type:Boolean,default:void 0},failIfMajorPerformanceCaveat:{type:Boolean,default:void 0},precision:{},logarithmicDepthBuffer:{type:Boolean,default:void 0},reverseDepthBuffer:{type:Boolean}},emits:["render","click","double-click","context-menu","pointer-move","pointer-up","pointer-down","pointer-enter","pointer-leave","pointer-over","pointer-out","pointer-missed","wheel","ready"],setup(e,{expose:t,emit:n}){const r=e,o=n,l=d.useSlots(),s=d.ref(),a=d.shallowRef(new v.Scene),c=d.getCurrentInstance();oe(_e);const i=(m,C=!1)=>d.defineComponent({setup(){var L;const p=(L=d.getCurrentInstance())==null?void 0:L.appContext;p&&(p.app=c==null?void 0:c.appContext.app);const _={};function A(P){P&&(P.parent&&A(P.parent),P.provides&&Object.assign(_,P.provides))}return c!=null&&c.parent&&r.enableProvideBridge&&(A(c.parent),Reflect.ownKeys(_).forEach(P=>{d.provide(P,_[P])})),d.provide("useTres",m),d.provide("extend",oe),typeof window<"u"&&mn(p==null?void 0:p.app,m),()=>d.h(d.Fragment,null,C?[]:l.default())}}),f=(m,C=!1)=>{const p=i(m,C),{render:_}=d.createRenderer(tn(m));_(d.h(p),a.value)},y=(m,C=!1)=>{fe(m.scene.value),C&&(m.renderer.value.dispose(),m.renderer.value.renderLists.dispose(),m.renderer.value.forceContextLoss()),a.value.__tres={root:m}},u=d.shallowRef(null);t({context:u,dispose:()=>y(u.value,!0)});const b=()=>{y(u.value),f(u.value,!0)};return d.onMounted(()=>{const m=s;u.value=We({scene:a.value,canvas:m,windowSize:r.windowSize??!1,rendererOptions:r,emit:o});const{registerCamera:C,camera:p,cameras:_,deregisterCamera:A}=u.value;f(u.value);const L=()=>{const P=new v.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);P.position.set(3,3,3),P.lookAt(0,0,0),C(P);const O=d.watchEffect(()=>{_.value.length>=2&&(P.removeFromParent(),A(P),O==null||O())})};d.watch(()=>r.camera,(P,O)=>{P&&C(P),O&&(O.removeFromParent(),A(O))},{immediate:!0}),p.value||L()}),d.onUnmounted(b),(m,C)=>(d.openBlock(),d.createElementBlock("canvas",{ref_key:"canvas",ref:s,"data-scene":a.value.uuid,class:d.normalizeClass(m.$attrs.class),"data-tres":`tresjs ${d.unref(ut).version}`,style:d.normalizeStyle({display:"block",width:"100%",height:"100%",position:m.windowSize?"fixed":"relative",top:0,left:0,pointerEvents:"auto",touchAction:"none",...m.$attrs.style})},null,14,hn))}}),gn=["TresCanvas","TresLeches","TresScene"],vn={template:{compilerOptions:{isCustomElement:e=>e.startsWith("Tres")&&!gn.includes(e)||e==="primitive"}}},{logWarning:yn}=G();let R=null;const _n={updated:(e,t)=>{var o;const n=Ot(t);if(!n){yn(`v-distance-to: problem with binding value: ${t.value}`);return}R&&(R.dispose(),e.parent.remove(R));const r=n.clone().sub(e.position);r.normalize(),R=new v.ArrowHelper(r,e.position,e.position.distanceTo(n),16776960),e.parent.add(R),console.table([["Distance:",e.position.distanceTo(n)],[`origin: ${e.name||e.type}`,`x:${e.position.x}, y:${e.position.y}, z:${(o=e.position)==null?void 0:o.z}`],[`Destiny: ${e.name||e.type}`,`x:${n.x}, y:${n.y}, z:${n==null?void 0:n.z}`]])},unmounted:e=>{R==null||R.dispose(),e.parent&&e.parent.remove(R)}};class et extends v.Line{constructor(t,n){const r=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new v.BufferGeometry;o.setAttribute("position",new v.Float32BufferAttribute(r,3)),o.computeBoundingSphere();const l=new v.LineBasicMaterial({fog:!1});super(o,l),this.light=t,this.color=n,this.type="RectAreaLightHelper";const s=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new v.BufferGeometry;a.setAttribute("position",new v.Float32BufferAttribute(s,3)),a.computeBoundingSphere(),this.add(new v.Mesh(a,new v.MeshBasicMaterial({side:v.BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const t=this.material.color,n=Math.max(t.r,t.g,t.b);n>1&&t.multiplyScalar(1/n),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const{logWarning:tt}=G();let le,F;const wn={DirectionalLight:v.DirectionalLightHelper,PointLight:v.PointLightHelper,SpotLight:v.SpotLightHelper,HemisphereLight:v.HemisphereLightHelper,RectAreaLight:et},bn={mounted:e=>{if(!e.isLight){tt(`${e.type} is not a light`);return}le=wn[e.type],e.parent.add(new le(e,1,e.color.getHex()))},updated:e=>{F=e.parent.children.find(t=>t instanceof le),!(F instanceof et)&&F.update()},unmounted:e=>{if(!e.isLight){tt(`${e.type} is not a light`);return}F=e.parent.children.find(t=>t instanceof le),F&&F.dispose&&F.dispose(),e.parent&&e.parent.remove(F)}},Cn={mounted:(e,t)=>{if(t.arg){console.log(`v-log:${t.arg}`,e[t.arg]);return}console.log("v-log",e)}},Mn={install(e){e.component("TresCanvas",Ze)}};w.TresCanvas=Ze,w.UseLoader=ft,w.UseTexture=Et,w.catalogue=re,w.createRenderLoop=Ee,w.default=Mn,w.dispose=fe,w.extend=oe,w.isProd=Rt,w.normalizeColor=$e,w.normalizeVectorFlexibleParam=zt,w.onTresReady=Yt,w.templateCompilerOptions=vn,w.traverseObjects=we,w.useCamera=Ie,w.useLoader=be,w.useLogger=G,w.useLoop=Jt,w.useRaycaster=Ue,w.useRenderLoop=Ht,w.useRenderer=Re,w.useSeek=Zt,w.useTexture=Be,w.useTres=Kt,w.useTresContext=Q,w.useTresContextProvider=We,w.useTresEventManager=Ve,w.vDistanceTo=_n,w.vLightHelper=bn,w.vLog=Cn,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
